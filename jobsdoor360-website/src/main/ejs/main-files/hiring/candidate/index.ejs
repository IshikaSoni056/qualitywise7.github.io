<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Job Listings</title>
    <link rel="stylesheet" href="/staticfiles/style.css" />
    <%- include('../../../partials/head.ejs') %>
  </head>
  <body>
    <%- include('../../../partials/navbar.ejs') %>

    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <h4 class="text-center text-white bg-dark p-2 mb-4">
            Candidate List
          </h4>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <table class="table table-bordered table-striped bg-light">
            <thead class="text-white text-center">
              <tr>
                <th class="text-center">Id</th>
                <th>Name</th>
                <th>Email</th>
                <th>Qualification</th>
                <th>Skill</th>
              </tr>
            </thead>
            <tbody id="users_data" class="text-center">
              <!-- Users'data will be added here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script type="module">
      const email = localStorage.getItem("email");
      if (!email) {
        window.location.href = "/login/?redirect_url=hiring";
      }

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDzoJJ_325VL_axuuAFzDf3Bwt_ENzu2rM",
        authDomain: "jobsdoor360-39b87.firebaseapp.com",
        databaseURL: "https://jobsdoor360-39b87-default-rtdb.firebaseio.com",
        projectId: "jobsdoor360-39b87",
        storageBucket: "jobsdoor360-39b87.appspot.com",
        messagingSenderId: "326416618185",
        appId: "1:326416618185:web:de19e90fe4f06006ef3318",
        measurementId: "G-60RHEMJNM6",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      document.addEventListener("DOMContentLoaded", async function () {
        const jobListings = document.getElementById("users_data");

        try {
          const querySnapshot = await getDocs(collection(db, "user_profile"));
          let id = 1; // Initialize ID counter
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${id++}</td> <!-- Increment the ID counter -->
              <td>${data.about.firstName || "not found"}</td>
              <td>${data.about.email || "not found"}</td>
              <td>${data.education.degree || "not found"}</td>
              <td>${data.skills || "not found"}</td>`;
            users_data.appendChild(row);
          });
        } catch (error) {
          console.error("Error retrieving users' data:", error);
        }
      });
    </script>

    <%- include('../../../partials/footer.ejs') %>
  </body>
</html>
